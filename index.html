<!doctype html><meta charset="utf-8">
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<body><p>起動中…</p>
<script>
const LIFF_ID = "2008180210-1WyAevA4";
const GAS_API = "https://script.google.com/macros/s/AKfycbwWUFUpNkNC7zp6CnVCxN-jwqLt0KAEBXNtdgvM8rFb5xMjMJs9x-WZ3pZp32trAwRn/exec"; // Web Apps (後述)

(async () => {
  await liff.init({ liffId: LIFF_ID });
  if (!liff.isLoggedIn()) { liff.login(); return; }

  const idToken = liff.getIDToken(); // openid スコープ必須
  // 例: SV/朝食
  const body = new URLSearchParams({
    action:"mint", form:"sv", mealType:"breakfast", idToken
  });
  const res = await fetch(GAS_API, {
    method:"POST", headers:{ "Content-Type":"application/x-www-form-urlencoded" }, body
  });
  const { ok, prefillUrl, error } = await res.json();
  if (!ok) throw new Error(error||"API error");
  location.href = prefillUrl; // フォームへ遷移
})();
</script>
</body>
