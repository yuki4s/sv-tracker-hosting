<!doctype html><meta charset="utf-8">
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<body><p>起動中…</p>
<script>
const LIFF_ID = "2008180210-1WyAevA4";
const GAS_API = "https://script.google.com/macros/s/AKfycbwWUFUpNkNC7zp6CnVCxN-jwqLt0KAEBXNtdgvM8rFb5xMjMJs9x-WZ3pZp32trAwRn/exec"; // Web Apps (後述)

(async () => {
  await liff.init({ liffId: LIFF_ID });
  if (!liff.isLoggedIn()) { liff.login(); return; }

  // 1) LINE 一意ID（sub）を取得（LIFFスコープに openid を付けること）
  const sub = liff.getDecodedIDToken()?.sub || "";

  // 2) GAS に送って，プレフィルURLを受け取る（simple request）
  const body = new URLSearchParams({ action:"mint", liffSub: sub });
  const res = await fetch(GAS_API, {
    method:"POST",
    headers:{ "Content-Type":"application/x-www-form-urlencoded" },
    body
  });
  const { ok, prefillUrl, error } = await res.json();
  if (!ok) throw new Error(error || "API error");

  // 3) Googleフォームへ遷移
  location.href = prefillUrl;
})().catch(e => {
  document.body.innerHTML = "<pre>起動失敗: " + String(e) + "</pre>";
});
</script>
</body>
